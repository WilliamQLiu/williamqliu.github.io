---
layout: post
title: RabbitMQ 
---


# {{ page.title }}

# Summary

__RabbitMQ__ is an open source message broker that implements a variety of message
protocols. RabbitMQ was originally developed to implement **AMQP** (Advanced
Message Queuing Protocol), a standard and cross-langauge protocol for messaging
middleware.

# Types of Protocols

RabbitMQ is a general purpose message broker. So what kind of protocols are there?
Some of these include:

* Point to Point
* Request/Reply
* Pub-Sub

# RabbitMQ Architecture

RabbitMQ can be used either synchronous or asynchronous.

## Tools

### rabbitmqctl

__rabbitmqctl__ is a command line tool for managing a RabbitMQ broker. It performs
all actions by connecting to one of the broker's nodes.

Commands include:

* `rabbitmqctl -l` to list commands
* `rabbitmqctl status` to show memory
* `rabbitmqctl stop_app` and `rabbitmqctl start_app`
* `rabbitmqctl reset` and `rabbitmqctl force_reset`
* `rabbitmqctl rotate_logs`
* `rabbitmqctl join_cluster` join a cluster as either a __disc__ (default) or __ram__ only
* `rabbitmqctl purge_queue <queue>` to remove all messages in it
* `rabbitmqctl list_queues` and `rabbitmqctl list_exchanges`

### rabbitmqadmin

__rabbitmqadmin__ is a command line tool that ships with the the management plugin,
allowing you to do some of the same actions as the web-based UI, making things a bit
more helpful for automation tasks. If you want to invoke rabbitmqadmin from your own
program, then consider using an HTTP API client library instead.

### rabbitmq-plugins

__rabbitmq-plugins__ is how you can enable plugins in RabbitMQ.

    rabbitmq-plugins list  # see what plugins are enabled
    rabbitmq-plugins enable <plugin-name>  # enable a plugin
    rabbitmq-plugins disable <plugin-name>  # disable a plugin

Plugins include:

* rabbitmq_auth_backend_http - authentication / authorisation plguin that uses an external HTTP API
* rabbitmq_management - a managemnet / monitoring API over HTTP, along with a browser-based UI (I use this all the time)
* rabbitmq_shovel - a plugin that shovels messages from a queue on one broker to an exchange on another broker
* rabbitmq_tracing - provides a GUI to capture traced messages and log them in text or JSON format
* rabbitmq-top is used to analyze node memory use
* rabbitmq-mqtt - lightweight messaging protcol for small sensors and mobile devices; good for high-latency or unreliable networks

### rabbitmq 'firehose'

RabbitMQ has a __firehose__ feature that the administrator can enable on a per-node, per-vhost basis,
basically making it so that an exchange's publish and delivery-notifications can be CC'd.

#### Enable firehose

1.) Decide which node (default is 'rabbit@(hostname)' and vhost (default is "/") you want to enable firehose for.
2.) In your vhost, when creating your queues, bind them to the topic exchange `amq.rabbitmq.trace` and start consuming
3.) Run `rabbitmqctl trace_on`

#### Disable firehose

1.) Run `rabbitmqctl trace_off`
2.) Clean up the queues used by the firehose

#### firehose Notification Format

Firehose publishes messages to the topic exchange `amq.rabbitmq.trace` with the
routing key `publish.exchangename` for messages entering the broker or to
the routing key `deliver.queuename` for messages leaving the broker.

